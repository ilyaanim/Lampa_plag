# Project Architecture: Lampa Wide Covers Plugin

## Overview
Plugin for Lampa.mx that changes the Full Detail View (movie page) layout:
- Poster becomes a wide backdrop image (16:9) spanning full width at the top
- Movie info (title, ratings, buttons, description) moves below the poster

## Files
- `wide_covers.js` — Main plugin file (self-contained, single JS file)
- `project_architecture` — This file, project documentation
- `README.md` — Installation and usage instructions

## Plugin Structure (wide_covers.js)

### Target: Full Detail View page
Original layout: `.full-start-new__body` is flex horizontal
- Left: `.full-start-new__left` (17em, poster 2:3)
- Right: `.full-start-new__right` (title, ratings, buttons)

Plugin changes layout to vertical:
- Top: wide backdrop image (aspect ratio ~45%, covers more area)
- Bottom: movie info

### Sections:
1. **CSS Injection** — Overrides `.full-start-new__body` to `flex-direction: column`,
   `.full-start-new__left` to `width: 100%`, `.full-start-new__poster` to
   `padding-bottom: 45%` (wide landscape). Image uses `object-fit: cover`.

2. **Listener Hook** — Uses `Lampa.Listener.follow('full', ...)` to intercept
   the detail page `complite` event and swap `poster_path` → `backdrop_path`
   (TMDB w1280 size) on the `.full--poster` img element.

3. **DOM Observer (fallback)** — MutationObserver watches for new
   `.full-start-new` blocks and swaps the image via `Lampa.Activity.active()`
   movie data.

4. **Settings** — Toggle in Settings → Interface → "Широкий постер"

### Key Lampa APIs used:
- `Lampa.Listener.follow('full', ...)` — hook into detail page rendering
- `Lampa.Activity.active()` — get current activity/movie data
- `Lampa.Storage` / `Lampa.Params` — persistent settings
- `Lampa.Template` / `Lampa.Lang` — templates and translations
- `Lampa.TMDB.img()` / `Lampa.Api.img()` — TMDB image URL builder

### CSS Classes:
- `wide-covers--enabled` — body class, toggles the feature
- `.full-start-new__*` — Lampa's Full Detail View elements being overridden

### Data flow:
1. App ready → inject CSS → set body class → register Listener + Observer
2. User opens movie page → `full` event fires with `type: 'complite'`
3. Plugin reads `movie.backdrop_path` → swaps img src to backdrop w1280
4. CSS forces vertical layout: wide poster top, info bottom
